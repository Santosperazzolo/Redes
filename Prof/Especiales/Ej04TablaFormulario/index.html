<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pagos</title>
  <style>
    :root {
      --page-bg: #f7efcb;
      --panel-border: #8c8268;
      --header-bg: #f7efcb;
      --button-bg: #c5c2bc;
      --button-border: #8c8268;
      --button-shadow: rgba(0, 0, 0, 0.18);
      --table-header-bg: #f1624d;
      --table-header-text: #2a100d;
      --table-body-bg: #9ecff4;
      --table-filler-bg: #8bc8ea;
      --table-footer-bg: #f1624d;
      --table-footer-text: #2a100d;
      --text-main: #2f2a24;
      font-size: 16px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Times New Roman', Times, serif;
      background: var(--page-bg);
      color: var(--text-main);
    }

    .page-wrapper {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      border: 2px solid var(--panel-border);
      box-shadow: 0 12px 32px rgba(55, 50, 35, 0.26);
      background: var(--page-bg);
    }

    header {
      padding: 38px clamp(28px, 8vw, 80px) 28px;
      border-bottom: 2px solid var(--panel-border);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 22px;
    }

    header h1 {
      margin: 0;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 1.9rem;
    }

    .actions {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .actions button {
      min-width: 190px;
      padding: 14px 24px;
      font-size: 1.05rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      border: 1px solid var(--button-border);
      border-radius: 4px;
      background: var(--button-bg);
      box-shadow: 0 4px 0 var(--button-shadow);
      cursor: pointer;
      transition: filter 0.2s ease;
    }

    .actions button:hover {
      filter: brightness(1.05);
    }

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(14, 12, 8, 0.58);
      padding: 28px;
      z-index: 1000;
    }

    .modal.is-visible {
      display: flex;
    }

    .modal__dialog {
      width: min(920px, 94vw);
      max-height: 92vh;
      display: flex;
      flex-direction: column;
      border: 2px solid var(--panel-border);
      border-radius: 10px;
      background: var(--page-bg);
      box-shadow: 0 20px 44px rgba(27, 22, 12, 0.4);
      overflow: hidden;
    }

    .modal__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: var(--table-header-bg);
      color: var(--table-header-text);
      padding: 18px 24px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: bold;
    }

    .modal__close {
      background: none;
      border: none;
      color: inherit;
      font-size: 1.55rem;
      line-height: 1;
      cursor: pointer;
    }

    .modal__body {
      flex: 1;
      padding: 0;
      background: var(--table-body-bg);
    }

    .modal__iframe {
      width: 100%;
      height: 70vh;
      border: none;
      background: #ffffff;
      display: block;
    }

    @media (max-width: 768px) {
      .modal__iframe {
        height: 78vh;
      }
    }

    main {
      flex: 1;
      display: flex;
      padding: 22px clamp(28px, 7vw, 88px) 28px;
    }

    .table-panel {
      flex: 1;
      border: 2px solid var(--panel-border);
      border-radius: 6px;
      background: var(--table-body-bg);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    table {
      width: 100%;
      height: 100%;
      border-collapse: collapse;
    }

    thead th {
      background: var(--table-header-bg);
      color: var(--table-header-text);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 18px 22px;
      border-bottom: 2px solid var(--panel-border);
      font-size: 1.05rem;
    }

    tbody {
      background: var(--table-body-bg);
    }

    tbody td {
      padding: 18px 22px;
      font-size: 1rem;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      background: rgba(255, 255, 255, 0.18);
    }

    tbody tr:nth-child(even) td {
      background: rgba(255, 255, 255, 0.32);
    }

    tbody .filler td {
      height: 100%;
      padding: 0;
      border-bottom: none;
      background: none;
    }

    tbody .filler div {
      height: 100%;
      background: var(--table-filler-bg);
    }

    td.numero {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    tfoot {
      background: var(--table-footer-bg);
      color: var(--table-footer-text);
    }

    tfoot td {
      padding: 16px 18px;
      border-top: 2px solid var(--panel-border);
      letter-spacing: 0.04em;
    }

    footer {
      padding: 20px 32px;
      text-align: center;
      border-top: 2px solid var(--panel-border);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: bold;
      background: var(--page-bg);
    }

    @media (max-width: 1024px) {
      header {
        padding: 28px clamp(18px, 12vw, 40px);
        gap: 16px;
      }

      .actions button {
        min-width: 160px;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <header>
      <h1>Pagos</h1>
      <div class="actions">
        <button type="button" id="loadBtn">Cargar datos</button>
        <button type="button" id="clearBtn">Vaciar datos</button>
        <button type="button" id="formBtn">Cargar Form</button>
      </div>
    </header>
    <div class="modal" id="formModal" role="dialog" aria-modal="true" aria-labelledby="formModalTitle" aria-hidden="true">
      <div class="modal__dialog">
        <div class="modal__header">
          <span id="formModalTitle">Formulario</span>
          <button type="button" class="modal__close" id="modalCloseBtn" aria-label="Cerrar formulario">&times;</button>
        </div>
        <div class="modal__body">
          <iframe class="modal__iframe" src="../Ej01FormVariableArregloDeObjetos/index.html" title="Formulario de carga"></iframe>
        </div>
      </div>
    </div>
    <main>
      <section class="table-panel" aria-live="polite">
        <table>
          <thead>
            <tr>
              <th scope="col">CodArt</th>
              <th scope="col">Familia</th>
              <th scope="col">UM</th>
              <th scope="col">Descripcion</th>
              <th scope="col">Fecha Alta</th>
              <th scope="col">Saldo Stock</th>
            </tr>
          </thead>
          <tbody id="tablaBody">
            <tr class="filler">
              <td colspan="6"><div></div></td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td id="sumCodArt">sum codArt</td>
              <td id="sumFamilia">sum familia</td>
              <td id="sumUm">sum um</td>
              <td id="sumDescripcion">sum descripcion</td>
              <td id="sumFechaAlta">sum fecha alta</td>
              <td id="sumSaldoStock">sum saldo Stock</td>
            </tr>
          </tfoot>
        </table>
      </section>
    </main>
    <footer>Pie</footer>
  </div>

  <script>
    const tablaBody = document.getElementById('tablaBody');
    const loadBtn = document.getElementById('loadBtn');
    const clearBtn = document.getElementById('clearBtn');
    const formBtn = document.getElementById('formBtn');
    const formModal = document.getElementById('formModal');
    const modalCloseBtn = document.getElementById('modalCloseBtn');

    const sumCodArt = document.getElementById('sumCodArt');
    const sumFamilia = document.getElementById('sumFamilia');
    const sumUm = document.getElementById('sumUm');
    const sumDescripcion = document.getElementById('sumDescripcion');
    const sumFechaAlta = document.getElementById('sumFechaAlta');
    const sumSaldoStock = document.getElementById('sumSaldoStock');

    const FILLER_ROW = '<tr class="filler"><td colspan="6"><div></div></td></tr>';

    const currencyFormatter = new Intl.NumberFormat('es-AR', {
      style: 'currency',
      currency: 'ARS',
      minimumFractionDigits: 2
    });

    const integerFormatter = new Intl.NumberFormat('es-AR');

    let formModalKeyHandler = null;
    let lastFocusedBeforeModal = null;

    function openFormModal() {
      if (!formModal) {
        return;
      }
      if (formModal.classList.contains('is-visible')) {
        return;
      }
      lastFocusedBeforeModal = document.activeElement;
      formModal.classList.add('is-visible');
      formModal.setAttribute('aria-hidden', 'false');
      formModalKeyHandler = (event) => {
        if (event.key === 'Escape') {
          event.preventDefault();
          closeFormModal();
        }
      };
      document.addEventListener('keydown', formModalKeyHandler);
      requestAnimationFrame(() => {
        modalCloseBtn?.focus();
      });
    }

    function closeFormModal() {
      if (!formModal) {
        return;
      }
      formModal.classList.remove('is-visible');
      formModal.setAttribute('aria-hidden', 'true');
      if (formModalKeyHandler) {
        document.removeEventListener('keydown', formModalKeyHandler);
        formModalKeyHandler = null;
      }
      if (lastFocusedBeforeModal instanceof HTMLElement) {
        lastFocusedBeforeModal.focus();
      } else if (formBtn) {
        formBtn.focus();
      }
    }

    function escapeHtml(value) {
      return String(value ?? '')
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function formatearFecha(valor) {
      if (!valor) {
        return '';
      }
      const fecha = new Date(valor);
      return Number.isNaN(fecha.getTime()) ? escapeHtml(valor) : fecha.toLocaleDateString('es-AR');
    }

    function obtenerFechaMasReciente(actual, candidata) {
      if (!candidata) {
        return actual;
      }
      if (!actual) {
        return candidata;
      }
      const fechaActual = new Date(actual);
      const fechaCandidata = new Date(candidata);
      if (Number.isNaN(fechaActual.getTime()) || Number.isNaN(fechaCandidata.getTime())) {
        return actual;
      }
      return fechaCandidata > fechaActual ? candidata : actual;
    }

    function resetTabla() {
      tablaBody.innerHTML = FILLER_ROW;
      resetFooter();
    }

    function resetFooter() {
      sumCodArt.textContent = 'sum codArt';
      sumFamilia.textContent = 'sum familia';
      sumUm.textContent = 'sum um';
      sumDescripcion.textContent = 'sum descripcion';
      sumFechaAlta.textContent = 'sum fecha alta';
      sumSaldoStock.textContent = 'sum saldo Stock';
    }

    function actualizarFooter({ contratos, dnis, cuotasTotal, clientes, fechaReciente, montoTotal }) {
      sumCodArt.textContent = `Contratos: ${integerFormatter.format(contratos)}`;
      sumFamilia.textContent = `DNIs distintos: ${integerFormatter.format(dnis)}`;
      sumUm.textContent = `Total cuotas: ${integerFormatter.format(cuotasTotal)}`;
      sumDescripcion.textContent = `Clientes: ${integerFormatter.format(clientes)}`;
      sumFechaAlta.textContent = fechaReciente ? `Ultimo pago: ${formatearFecha(fechaReciente)}` : 'Sin fechas';
      sumSaldoStock.textContent = `Monto total: ${currencyFormatter.format(montoTotal)}`;
    }

    function renderTabla(data) {
      if (!data.length) {
        resetTabla();
        return;
      }

      const fragment = document.createDocumentFragment();
      const contratos = new Set();
      const dnis = new Set();
      const clientes = new Set();
      let cuotasTotal = 0;
      let montoTotal = 0;
      let fechaReciente = '';

      data.forEach((pago) => {
        const contrato = pago?.IdContrato;
        const dni = pago?.DNIDeudor;
        const cuota = Number(pago?.CuotaNro) || 0;
        const cliente = pago?.Apellido_Nombres;
        const fechaPago = pago?.FechaPago;
        const monto = Number(pago?.MontoPagado) || 0;

        contratos.add(contrato);
        dnis.add(dni);
        clientes.add(cliente);
        cuotasTotal += cuota;
        montoTotal += monto;
        fechaReciente = obtenerFechaMasReciente(fechaReciente, fechaPago);

        const fila = document.createElement('tr');
        fila.innerHTML = `
          <td>${escapeHtml(contrato)}</td>
          <td>${escapeHtml(dni)}</td>
          <td class="numero">${integerFormatter.format(cuota)}</td>
          <td>${escapeHtml(cliente)}</td>
          <td>${formatearFecha(fechaPago)}</td>
          <td class="numero">${currencyFormatter.format(monto)}</td>
        `;
        fragment.appendChild(fila);
      });

      tablaBody.innerHTML = '';
      tablaBody.appendChild(fragment);

      actualizarFooter({
        contratos: contratos.size,
        dnis: dnis.size,
        cuotasTotal,
        clientes: clientes.size,
        fechaReciente,
        montoTotal
      });
    }

     src="pagos.json">
document.addEventListener("DOMContentLoaded", function(){
  const tablaBody = document.getElementById("tablaBody");

  // Botón cargar
  document.getElementById("loadBtn").addEventListener("click", function(){
    tablaBody.innerHTML = "";
    pagosData.PagoCuotasTransferencia.forEach(pago => {
      tablaBody.innerHTML += `
        <tr>
          <td>${pago.IdContrato}</td>
          <td>${pago.DNIDeudor}</td>
          <td>${pago.CuotaNro}</td>
          <td>${pago.Apellido_Nombres}</td>
          <td>${pago.FechaPago}</td>
          <td>${pago.MontoPagado}</td>
        </tr>
      `;
    });
  });

  // Botón vaciar
  document.getElementById("clearBtn").addEventListener("click", function(){
    tablaBody.innerHTML = "";
  });
});

    if (formBtn) {
      formBtn.addEventListener('click', () => {
        openFormModal();
      });
    }

    if (formModal) {
      formModal.addEventListener('click', (event) => {
        if (event.target === formModal) {
          closeFormModal();
        }
      });
    }

    if (modalCloseBtn) {
      modalCloseBtn.addEventListener('click', () => {
        closeFormModal();
      });
    }

    loadBtn.addEventListener('click', cargarPagos);
    clearBtn.addEventListener('click', () => {
      resetTabla();
    });

    resetTabla();
  </script>
</body>
</html>



